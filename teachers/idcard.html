<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>教師證</title>
  <meta property="og:title" content="謝爾夏證件" id="ogTitle">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://shierusha.github.io/school-battle/teachers/th.css">
</head>
<body>
 
<div class="flip-card" id="flipCard">
<div class="flip-card-inner">
      <!-- 正面BG ------------------------------------->  
<div class="flip-card-front">
<div  class="container-16-9">
  <img class="bg-img" src="https://shierusha.github.io/school-battle/teachers/img/1.webp" alt="background" />

<!-- 正面 ----------------------------------->
<div class="imgarea"> 
  <img class="char-img" src="https://shierusha.github.io/school-battle/teachers/img/ro.png" alt="teacherimg">
</div>
  
<div class="bigname-box">
  <div class="name-box bigname"></div>
</div>
  
<div class="littlename-box">
  <div class="name-box littlename"></div>
</div>

<div class="row">
  <div class="row-1" style="left: 0;  width: 100%;">
    <div class="info-box" style="height:7%;width: 49%;">
      <span class="info-label">陣營</span>
      <span class="info-value"></span>
    </div>

    <div class="info-box" style="height:7%;width: 49%;">
      <span class="info-label">種族</span>
      <span class="info-value"></span>
    </div>

    <div class="info-row" style="gap:2%;height:7%;width: 49%;">
      <div class="info-box" style=" width:49%;">
        <span class="info-label">年齡</span>
        <span class="info-value"></span>
      </div>
      <div class="info-box" style=" width:49%;">
        <span class="info-label">性別</span>
        <span class="info-value"></span>
      </div>
    </div>

    <div class="info-box" style="height:15%;width: 49%;">
      <span class="info-label">個性</span>
      <span class="info-value" ></span>
  <button class="show-more-btn" style="display:none;">...MORE</button>


    </div>

    <div class="info-box" style="height:7%;width: 49%;">
      <span class="info-label">喜歡</span>
      <span class="info-value"></span>
  <button class="show-more-btn" style="display:none;">...MORE</button>

    </div>

    <div class="info-box" style="height:7%;width: 49%;">
      <span class="info-label">討厭</span>
      <span class="info-value"></span>
  <button class="show-more-btn" style="display:none;">...MORE</button>

    </div> 
    <div class="info-box" style="height:7%;border-radius:5px 5px 0px 0px;">
      <span class="info-label">角色備註</span>
      <span style="color: #495079; font-weight: 700;  letter-spacing: 0.05em; padding-left: 0.3em;  align-self: center;
 ">裏設定</span>

    </div>

    <div class="info-box" style="height:31%;margin-top:-1.3%;border-radius:0px 0px 5px 5px;">
      
      <span class="info-label" style="display: none;">角色備註/裏設定</span>
      <span class="info-value"  style="margin-top: 0.35em;"></span>
  <button class="show-more-btn" style="display:none;">...MORE</button>
    </div>  
  </div>

  <div class="row-1" style="right:0; height: 90%;">
    <div class="info-row" style="gap:2%; height:7.63%;">
      <div class="info-box" style=" width:49%;">
        <span class="info-label">身高</span>
        <span class="info-value"></span>
      </div>
      <div class="info-box" style=" width:49%;">
        <span class="info-label">體重</span>
        <span class="info-value"></span>
      </div>
    </div>

    <div class="info-box" style="height:7%;border-radius:5px 5px 0px 0px;">
      <span class="info-label">背景故事</span>
      <span style="color: #495079;
  font-weight: 700;  letter-spacing: 0.05em; padding-left: 0.3em;  align-self: center;
 ">設定</span>
    </div>
    <div class="info-box" style="height:49.8%;margin-top:-2.8%;border-radius:0px 0px 5px 5px;">
      <span class="info-label" style="display: none;">背景故事/設定</span>
      <span class="info-value" style="margin-top: 0.35em;">
      </span>
  <button class="show-more-btn" style="display:none;">...MORE</button>

    </div> 
  </div>
    
</div>
          <!-- 正面 ----------------------------------->
</div>
</div>
</div>
</div>


<div id="info-modal" class="modal-overlay" style="display:none;">
  <div class="modal-content">
    <div class="modal-header" id="info-modal-title">標題</div>
    <div class="modal-body" id="info-modal-body"></div>
  </div>
</div>

<script src="teachers-data.js"></script>

<script>
function setNameFontSize(selector, maxChars) {
  document.querySelectorAll(selector).forEach(box => {
    const nameDiv = box.querySelector('.name-box');
    if (!nameDiv) return;
    const fontSize = box.offsetHeight / maxChars * 0.98;
    nameDiv.style.fontSize = fontSize + "px";
  });
}

function fitAllNameBoxes() {
  setNameFontSize('.bigname-box', 12);
  setNameFontSize('.littlename-box', 9);
}

function setInfoBoxFontSize() {
  const infoBoxes = document.querySelectorAll('.info-box');
  if (!infoBoxes.length) return;
  let minHeight = Infinity;
  infoBoxes.forEach(box => {
    const h = box.offsetHeight;
    if (h < minHeight) minHeight = h;
  });
  const fontSize = minHeight * 0.62;
  infoBoxes.forEach(box => {
    box.style.fontSize = fontSize + "px";
  });
}

function fitAll() {
  fitAllNameBoxes();
  setInfoBoxFontSize();
}

window.addEventListener('DOMContentLoaded', fitAll);
window.addEventListener('resize', fitAll);
window.addEventListener('load', fitAll);



  // 更多
// 判斷 info-value 超過 13 字才顯示 ...MORE
function checkLongTextByCharCount(N = 13) {
  document.querySelectorAll('.info-box').forEach(box => {
    const value = box.querySelector('.info-value');
    const btn = box.querySelector('.show-more-btn');
    if (!value || !btn) return;
    if (value.innerText.trim().length > N) {
      btn.style.display = 'block';
      btn.onclick = function() {
        const label = box.querySelector('.info-label')?.innerText || "內容";
        showInfoModal(label, value.innerHTML);
      }
    } else {
      btn.style.display = 'none';
    }
  });
}
// 初次和視窗大小變動時都要判斷一次
window.addEventListener('DOMContentLoaded', () => checkLongTextByCharCount(13));
window.addEventListener('resize', () => checkLongTextByCharCount(13));



// 彈跳視窗相關
function showInfoModal(title, content) {
  document.getElementById('info-modal-title').innerText = title;
  document.getElementById('info-modal-body').innerHTML = content;
  document.getElementById('info-modal').style.display = 'flex';
}

// 點背景關閉彈窗
document.getElementById('info-modal').addEventListener('click', function(e) {
  if (e.target === this) this.style.display = 'none';
});


//帶入老師參數
function applyTeacherData() {
  const urlParams = new URLSearchParams(window.location.search);
  const teacherId = urlParams.get("teacher") || "papa";
  const teacher = window.teachers?.[teacherId];
  if (!teacher) return;

  // ← 這裡加
  if (teacher.title) {
  document.title = "謝爾夏 " + teacher.title;
  document.querySelector('meta[property="og:title"]').setAttribute('content', "謝爾夏 " + teacher.title);
} else {
  document.title = "謝爾夏 教師證";
  document.querySelector('meta[property="og:title"]').setAttribute('content', "謝爾夏 教師證");
}


  
  // 自動控制背景濾鏡
  if (teacher.useDarkBg) {
    document.body.classList.add("dark-bg");
  } else {
    document.body.classList.remove("dark-bg");
  }
  // 套圖片與名字
  document.querySelector(".char-img").src = teacher.img;
  document.querySelector(".bg-img").src = teacher.bg;
  document.querySelector(".bigname").textContent = teacher.bigname;
  document.querySelector(".littlename").textContent = teacher.littlename;

  // 套 info-label 對應內容
  document.querySelectorAll(".info-box").forEach(box => {
    const label = box.querySelector(".info-label");
    const value = box.querySelector(".info-value");
    if (!label || !value) return;

    const key = label.textContent.trim();
    if (teacher.info[key] !== undefined) {
      value.textContent = teacher.info[key];
    }
  });

  // 字體與 MORE 重新確認
  fitAll();
  checkLongTextByCharCount(13);
}

window.addEventListener("DOMContentLoaded", applyTeacherData);

//黑白濾境
window.addEventListener("DOMContentLoaded", () => {
  const toggleBtn = document.getElementById('toggleBgBtn');
  if (toggleBtn) {
    toggleBtn.onclick = function() {
      document.body.classList.toggle('dark-bg');
    }
  }
});

</script>


</body>
</html>
